# 퀀트 전략 구현 차이점 분석

## 문서 의도 vs 현재 구현

### 문서의 의도 (9단계 리밸런싱 시스템)

1. **15:40 퀀트 스크리닝**
   - 전체 종목 → 필터링 → 팩터 계산 → 상위 50개 선정
   - 결과를 DB `quant_portfolio` 테이블에 저장

2. **익일 09:05 리밸런싱 실행**
   - 현재 보유 종목 vs 목표 포트폴리오(상위 50개) 비교
   - **매도**: 보유 중이지만 목표 포트에 없는 종목 → 시장가 전량 매도
   - **매수**: 목표 포트에 있지만 보유하지 않은 종목 → 동등 비중 시장가 매수
   - 리밸런싱 후에는 선정된 50개 종목만 보유

3. **장중 모니터링**
   - 리밸런싱으로 선정된 50개 종목만 모니터링
   - 실시간 매수 판단은 하지 않음 (리밸런싱으로만 포지션 구성)

### 현재 구현 상태

1. **15:40 퀀트 스크리닝** ✅
   - `QuantScreeningService`로 실행
   - 상위 50개 선정 및 DB 저장

2. **익일 09:05 리밸런싱** ✅ (2025-11-18 추가)
   - `_rebalancing_task()` 태스크 추가
   - 09:05 시점에 리밸런싱 계획 계산 및 실행
   - 매도 → 매수 순서로 진행

3. **장중 모니터링** ⚠️ (문서와 다름)
   - `_check_condition_search()`가 60초마다 실행
   - 퀀트 후보 종목을 모니터링에 추가
   - 실시간으로 3분봉 완성 후 매수 판단 실행
   - **문제**: 문서 의도와 다르게 실시간 매수 판단 방식으로 동작

## 주요 차이점

### 1. 매매 방식

**문서 의도:**
- 리밸런싱 방식: 09:05에 한 번에 포지션 구성
- 장중에는 매매하지 않음 (보유 종목만 모니터링)

**현재 구현:**
- 리밸런싱 + 실시간 매수 판단 혼합
- 09:05 리밸런싱으로 포지션 구성
- 장중에도 3분봉 완성 후 매수 판단 실행

### 2. 모니터링 대상

**문서 의도:**
- 리밸런싱으로 선정된 50개 종목만 모니터링

**현재 구현:**
- `_check_condition_search()`가 60초마다 퀀트 후보를 모니터링에 추가
- 실시간으로 새로운 종목이 모니터링 대상에 추가됨

## 개선 방안

### 옵션 1: 문서 의도대로 순수 리밸런싱 방식 (권장)

1. `_check_condition_search()` 비활성화 또는 제거
2. 실시간 매수 판단 로직 비활성화
3. 리밸런싱으로 선정된 50개 종목만 모니터링
4. 장중에는 매도 판단만 실행 (손절/익절)

**장점:**
- 문서 의도와 일치
- 포지션 관리 단순화
- 리밸런싱 전략의 순수성 유지

**단점:**
- 실시간 기회 포착 불가

### 옵션 2: 하이브리드 방식 (현재 유지)

1. 09:05 리밸런싱으로 기본 포지션 구성
2. 장중 실시간 매수 판단으로 추가 기회 포착
3. 두 가지 방식 병행

**장점:**
- 리밸런싱 + 실시간 기회 포착
- 유연한 전략 운영

**단점:**
- 문서 의도와 다름
- 포지션 관리 복잡도 증가

## 권장 사항

**문서의 의도대로 순수 리밸런싱 방식을 권장합니다.**

이유:
1. 문서의 명확한 전략 의도
2. 포지션 관리 단순화
3. 백테스트 결과와 일치

구현 방법:
1. `_check_condition_search()` 호출 주석 처리 또는 제거
2. `_analyze_buy_decision()` 호출 조건 수정 (리밸런싱 종목만)
3. 또는 리밸런싱 모드 설정 추가 (`config/trading_config.json`)

## 현재 상태 (2025-11-18)

✅ 리밸런싱 시스템 통합 완료
- `QuantRebalancingService` 초기화
- `_rebalancing_task()` 태스크 추가
- 09:05 리밸런싱 실행 로직 구현

⚠️ 실시간 매수 판단과 병행 중
- `_check_condition_search()` 60초마다 실행
- `_analyze_buy_decision()` 3분봉 완성 후 실행

## 다음 단계

1. 사용자 확인: 순수 리밸런싱 vs 하이브리드 방식 선택
2. 선택에 따라 코드 수정
3. 테스트 및 검증


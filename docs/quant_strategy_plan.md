# 퀀트 전략 구현 작업 순서

## 1단계: 데이터 수집 인프라 구축

### 1.1 재무 데이터 API 연동
- 목적: 팩터 계산에 필요한 재무제표 데이터 수집
- 필요 데이터: PER, PBR, EPS, BPS, ROE, ROA, 부채비율, 영업이익률, 매출액, 순이익, 시가총액, 업종 코드
- 작업: KIS API 엔드포인트 확인, 전체 종목 데이터 수집 함수 구현, 일일 캐싱, DB 저장

### 1.2 과거 가격 데이터 수집
- 목적: Momentum 팩터 계산 위한 일봉 데이터 확보
- 필요 데이터: 1년치 OHLCV
- 작업: 일봉 조회 함수 구현, 초기 1년치 수집, 일일 업데이트, DB 저장

## 2단계: 1차 필터링 로직 구현
- 필터 조건: 시총 ≥ 1,000억원, 일평균 거래대금 ≥ 10억원, 주가 1,000~500,000원, 관리/거래정지 제외, 상장 1년 이상, 재무데이터 존재
- 작업: 전체 종목 리스트 조회, 각 조건 체크, 필터 결과 로깅

## 3단계: Value 팩터 (30%)
- PER/PBR/PSR/PCR/EVEBITDA 점수 계산, 업종 평균 대비 상대 평가, 적자·자본잠식 처리
- Value 점수 = PER(25%) + PBR(25%) + PCR(20%) + PSR(15%) + EV/EBITDA(15%)

## 4단계: Momentum 팩터 (30%)
- 수익률 계산: 1M/3M/6M/12M 백분위 → 점수화
- RSI(14) 계산, 과매수/과매도 점수 조정
- Momentum 점수 = 1M(15%) + 3M(25%) + 6M(30%) + 12M(20%) + RSI(10%)

## 5단계: Quality 팩터 (20%)
- ROE, ROA, 부채비율, 유동비율, 영업이익률을 구간별 점수화
- Quality 점수 = ROE(30%) + ROA(20%) + 부채비율(20%) + 유동비율(15%) + 영업이익률(15%)

## 6단계: Growth 팩터 (20%)
- 매출/순이익/EPS 성장률(1년/3년) 계산 후 구간 점수화
- Growth 점수 = 1년 매출(30%) + 3년 매출(25%) + 1년 순이익(25%) + 1년 EPS(20%)

## 7단계: 종합 스코어링
- 최종 점수 = Value(30%) + Momentum(30%) + Quality(20%) + Growth(20%)
- 종목 순위 부여, 상위 50개 선정 (동점 시 Momentum 우선)

## 8단계: 스크리닝 스케줄러
- 매일 15:40 실행, 전체 종목 → 필터 → 팩터 계산 → 순위 → 저장
- 스케줄러 클래스, 오류 재시도, 진행 로깅 구현

## 9단계: 리밸런싱 시스템
- 보유 vs 목표 포트 비교, 매도·매수 대상 산출
- 매도: 익일 09:05 시장가 전량
- 매수: 동등 비중, 시장가 주문
- 리밸런싱 주기 선택(일간/주간/월간)

## 10단계: 기존 프로그램 통합
- `strategies/quant_strategy.py`: 상위 50개면 BUY 신호 반환
- `strategies/combined_strategy.py`: quant 40%, pullback 20%, momentum 15%, breakout 10%, 기타 15%
- DB 테이블 추가: financial_data, price_history, quant_scores, quant_portfolio

## 11단계: 테스트 및 검증
- 단위 테스트(팩터, 필터, 점수, 순위, 수량 계산)
- 백테스트(1년, 월간 리밸런싱, KOSPI 비교)
- 실전 모의 운영(1주, 테스트 모드)

## 12단계: 모니터링 및 알림
- 스크리닝/리밸런싱 결과 텔레그램 알림 (상위 종목, 매수·매도 현황 등)

## 일정 요약
- 1단계 2일, 2단계 0.5일, 3~6단계 각 2일, 7단계 1일, 8단계 1일, 9단계 2일, 10단계 2일, 11단계 4일, 12단계 1일 (총 약 3주)

## 우선순위
- 1주차: 재무/가격 데이터 수집, 필터링, Value 팩터
- 2주차: Momentum/Quality/Growth, 스코어링
- 3주차: 스케줄러, 리밸런싱, 통합, 테스트/검증


## 구현 현황 요약 (업데이트)

- 2단계: 1차 필터링 구현
  - 시총 ≥ 1,000억원, 최근 20일 일평균 거래대금 ≥ 10억원, 주가 1,000~500,000원, 상장 ≥ 250 거래일, 재무데이터 존재 확인
  - 통계 로깅(제외 사유 TOP5) 추가

- 3~6단계: 팩터 점수 계산 적용
  - Value: PER/PBR/PSR 점수화(임시 기준값 기반), EPS/BPS 음수 0점 처리. PCR, EV/EBITDA는 추후 데이터 확충 시 추가
  - Momentum: 1M/3M/6M/12M 수익률 + RSI(14) 점수, 가중치 계획서대로 반영
  - Quality: ROE/ROA(근사)/부채·유동비율(근사)/영업이익률 점수, 가중치 반영
  - Growth: 매출·순이익·EPS 성장률 점수(일부 근사), 가중치 반영

- 7단계: 종합 스코어링 및 동점 처리
  - 최종 점수 = Value(30%) + Momentum(30%) + Quality(20%) + Growth(20%)
  - 동점 시 Momentum 우선 정렬, 상위 50개 선정 저장

- 8단계: 스케줄러
  - 15:40 일일 스크리닝 실행
  - 오류 재시도(기본 3회) 및 상위 5개 텔레그램 알림

- 9단계: 리밸런싱
  - `core/quant/quant_rebalancing_service.py`
  - 보유 vs 목표 비교 → 매도/매수/유지 산출, 동등 비중 매수
  - 주기: 일간/주간/월간 지원

- 10단계: 통합 전략
  - `strategies/quant_strategy.py`: 상위 50 포함 시 BUY
  - `strategies/combined_strategy.py`: quant 40%, pullback 20%, momentum 15%, breakout 10%, 기타 15%

- 11단계: 테스트/백테스트
  - 단위 테스트: `tests/test_quant_factors.py`, `tests/test_primary_filter.py`, `tests/test_rebalancing.py`
  - 월간 리밸런싱 백테스트: `backtests/quant_monthly_backtest.py`

- 실행/운영
  - 배치: `run_robotrader.bat` 개선 (UTF-8, 로그 파일, 선택적 pip/requirements 설치, PID 경고)
  - 가상 매매 모드: `config/trading_config.json` → `"paper_trading": true` (기본 활성화)
  - 실제 매매 전환 시 `"paper_trading": false` 로 변경


## 실행/운영 메모

- 일일 스크리닝: 메인 프로세스에서 15:40 자동 실행 (실패 시 3회 재시도)
- 상위 포트/팩터 저장: DB `quant_portfolio`, `quant_factors`
- 텔레그램: 스크리닝 완료 후 상위 5개 종목 요약 전송
- 리밸런싱: 계획 계산/실행 분리(실행부는 향후 예약 주문 로직으로 확장 예정)
